---
/**
 * ContactForm - Contact form with HTML5 validation
 * Uses Astro form handling
 */

import { getCollection } from "astro:content";

const services = await getCollection("services");
const sortedServices = services.sort((a, b) => a.data.order - b.data.order);
---

<div class="contact-form-wrapper">
  <h3 class="form-title">Send Us a Message</h3>

  <form class="contact-form" method="POST" action="/api/contact">
    <div class="form-group">
      <label for="name" class="form-label">
        Full Name <span class="required">*</span>
      </label>
      <input
        type="text"
        id="name"
        name="name"
        required
        autocomplete="name"
        placeholder="John Doe"
        class="form-input"
      />
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="email" class="form-label">
          Email <span class="required">*</span>
        </label>
        <input
          type="email"
          id="email"
          name="email"
          required
          autocomplete="email"
          placeholder="john@example.com"
          class="form-input"
        />
      </div>

      <div class="form-group">
        <label for="phone" class="form-label">Phone</label>
        <input
          type="tel"
          id="phone"
          name="phone"
          autocomplete="tel"
          placeholder="(718) 555-0123"
          class="form-input"
        />
      </div>
    </div>

    <div class="form-group">
      <label for="service" class="form-label">Service Interest</label>
      <select id="service" name="service" class="form-select">
        <option value="">Select a service (optional)</option>
        {sortedServices.map((service) => (
          <option value={service.data.slug}>{service.data.title}</option>
        ))}
        <option value="other">Other / Not Sure</option>
      </select>
    </div>

    <div class="form-group">
      <label for="message" class="form-label">
        Message <span class="required">*</span>
      </label>
      <textarea
        id="message"
        name="message"
        required
        rows="5"
        placeholder="How can we help you?"
        class="form-textarea"
      ></textarea>
    </div>

    <button type="submit" class="form-submit">
      Send Message
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <line x1="22" y1="2" x2="11" y2="13"/>
        <polygon points="22 2 15 22 11 13 2 9 22 2"/>
      </svg>
    </button>

    <p class="form-disclaimer">
      By submitting this form, you agree to our privacy policy.
      We'll respond within 24 hours during business days.
    </p>
  </form>
</div>

<style>
  .contact-form-wrapper {
    background: var(--color-surface-elevated);
    padding: 2rem;
    border-radius: var(--radius-xl);
    border: 1px solid var(--color-border);
  }

  .form-title {
    font-size: var(--font-size-xl);
    margin-bottom: 1.5rem;
  }

  .contact-form {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;

    @media (max-width: 480px) {
      grid-template-columns: 1fr;
    }
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .form-label {
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    color: var(--color-text);
  }

  .required {
    color: var(--color-error);
  }

  .form-input,
  .form-select,
  .form-textarea {
    padding: 0.75rem 1rem;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    font-size: var(--font-size-base);
    background: var(--color-surface);
    color: var(--color-text);
    transition: border-color var(--transition-fast), box-shadow var(--transition-fast);

    &::placeholder {
      color: var(--color-text-muted);
    }

    &:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px oklch(55% 0.18 240 / 0.15);
    }

    &:invalid:not(:placeholder-shown) {
      border-color: var(--color-error);
    }
  }

  .form-select {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    background-size: 1rem;
    padding-right: 2.5rem;
    cursor: pointer;
  }

  .form-textarea {
    resize: vertical;
    min-height: 120px;
  }

  .form-submit {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 1rem 2rem;
    background: var(--color-primary);
    color: var(--color-text-inverted);
    border: none;
    border-radius: var(--radius-md);
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-medium);
    cursor: pointer;
    transition: background-color var(--transition-fast);

    &:hover {
      background: var(--color-primary-dark);
    }

    &:focus-visible {
      outline: 2px solid var(--color-primary);
      outline-offset: 2px;
    }
  }

  .form-disclaimer {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    text-align: center;
    margin-top: 0.5rem;
  }
</style>
